{"version":3,"sources":["legacy\\jsx\\core\\store\\Fluxbone.jsx"],"names":["Dispatcher","require","_","Backbone","UserSession","Messages","Toastr","Model","extend","parse","response","opts","data","Store","Collection","BACKEND_URL","userSession","$dispatcherActionRegex","$dispatcher","dispatchAcceptRegex","dispatch","payload","initialize","dispatchToken","register","dispatchCallback","bind","on","handleRequestErrors","msg","remove","error","total","action","match","method","exec","cb","err","console","warn","collection","status","resp","JSON","responseText","message","get","ModelState","errors","each","field","e","length","push","trigger","Message","refreshStatus","retrieve","id","me","model","defer","fetch","url","success","options","xhr","update","add","save","destroy","find","updateField","params","$","ajax","dataType","errorMsg","module","exports"],"mappings":"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","file":"Fluxbone.jsx","sourceRoot":"C:/Projetos/Nova pasta/ilevus/Ilevus/Views","sourcesContent":["/**\r\n    Este componente extende as funcionalidades de modelo e store do Backbone para que atenda\r\n    ao padr�o de projeto Flux que � utilizado com o React. Este padr�o de projeto define um fluxo\r\n    unidirecional de dados dentro da estrutura do frontend, onde os componentes visuais despacham\r\n    requisi��es de dados �s stores. As stores n�o devolvem os dados diretamente � esses componentes,\r\n    elas recuperam os dados e disparam eventos quando estes dados est�o prontos para uso. Os\r\n    componentes visuais que est�o interessados nesses dados registram listeners nas stores apropriadas.\r\n\r\n    Essa arquitetura implementada com o Backbone.js foi chamada de Fluxbone.\r\n    Esta arquitetura permite que sejam contru�das interfaces reativas com um fluxo e funcionamento f�ceis\r\n    de entender. Al�m de ser extramamente f�cil de se utilizar com o React.\r\n\r\n    Aqui est�o implementados os principais m�todos da store, a store de cada entidade pode criar\r\n    novos m�todos e especializar o funcionamento da store.\r\n*/\r\n\r\nvar Dispatcher = require(\"flux\").Dispatcher;\r\nvar _ = require('underscore');\r\nvar Backbone = require(\"backbone\");\r\nvar UserSession = require(\"ilevus/jsx/core/store/UserSession.jsx\");\r\nvar Messages = require(\"ilevus/jsx/core/util/Messages.jsx\");\r\nvar Messages = require(\"ilevus/jsx/core/util/Messages.jsx\");\r\nvar Toastr = require(\"toastr\")\r\n\r\nvar Model = Backbone.Model.extend({\r\n\tparse(response, opts) {\r\n\t\tif (response.data) {\r\n\t\t\treturn response.data;\r\n\t\t}\r\n\t\treturn response;\r\n\t}\r\n});\r\n\r\nvar Store = Backbone.Collection.extend({\r\n    BACKEND_URL: BACKEND_URL,\r\n    userSession: UserSession,\r\n\t$dispatcherActionRegex: /[a-zA-Z0-9]+$/,\r\n\t$dispatcher: new Dispatcher(),\r\n\tdispatchAcceptRegex: /^[a-zA-Z0-9]*-?[a-zA-Z0-9]+$/,\r\n\tdispatch(payload) {\r\n\t\tthis.$dispatcher.dispatch(payload);\r\n\t},\r\n\tinitialize() {\r\n\t\tthis.dispatchToken = this.$dispatcher.register(this.dispatchCallback.bind(this));\r\n\t\tthis.on(\"error\", this.handleRequestErrors, this);\r\n\t\tthis.on(\"fail\", (msg) => {\r\n\t\t    Toastr.remove();\r\n\t\t    Toastr.error(msg);\r\n\t\t}, this);\r\n\t},\r\n\tparse(response, opts) {\r\n\t\tthis.total = response.total;\r\n\t\tif (response.data)\r\n\t\t    return response.data;\r\n\t\treturn response;\r\n\t},\r\n\tdispatchCallback(payload) {\r\n\t\tif (payload.action && payload.action.match(this.dispatchAcceptRegex)) {\r\n\t\t\tvar method = this.$dispatcherActionRegex.exec(payload.action)[0];\r\n\t\t\tif (method) {\r\n\t\t\t\tvar cb = this[method];\r\n\t\t\t\tif (typeof cb == 'function') {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tthis[method](payload.data);\r\n\t\t\t\t\t} catch (err) {\r\n\t\t\t\t\t\tconsole.error(\"Store: Dispatching\",payload.action, \"failed:\",err);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t    console.warn(\"Store: Dispatch action is not a function:\", (typeof cb), method, payload,this);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tconsole.warn(\"Store: Invalid dispatch action:\",payload.action);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\thandleRequestErrors(collection, opts) {\r\n\t    console.error(\"Error ocurred:\\n\",collection,\"\\n\", opts);\r\n\t    if (opts.status == 400) {\r\n\t\t\t// Validation errors\r\n\t\t\tvar resp;\r\n\t\t\ttry {\r\n\t\t\t\tresp = JSON.parse(opts.responseText);\r\n\t\t\t} catch (err) {\r\n\t\t\t\tresp = {\r\n\t\t\t\t    message: Messages.get(\"TextUnexpectedError\")\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\tif (resp.ModelState) {\r\n\t\t\t    var errors = [];\r\n\t\t\t    _.each(resp.ModelState, (field) => {\r\n\t\t\t        for (var e = 0; e < field.length; e++)\r\n\t\t\t            errors.push(field[e]);\r\n\t\t\t    });\r\n\t\t\t    this.trigger(\"fail\", errors);\r\n\t\t\t} else {\r\n\t\t\t    this.trigger(\"fail\", resp.Message);\r\n\t\t\t}\r\n\t    } else if ((opts.status == 401) || (opts.status == 403)) {\r\n\t\t\t// Unauthorized/Forbidden\r\n\t\t    this.userSession.refreshStatus();\r\n\t\t} else {\r\n\t\t    this.trigger(\"fail\", Messages.get(\"TextUnexpectedError\"));\r\n\t\t}\r\n\t},\r\n\tretrieve(id) {\r\n\t\tvar me = this,\r\n\t\t\tmodel = me.get(id);\r\n\t\tif (model) {\r\n\t\t\t_.defer(function() {\r\n\t\t\t\tme.trigger(\"retrieve\", model);\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tmodel = new me.model();\r\n\t\t\tmodel.fetch({\r\n\t\t\t\turl: me.url + \"/\" + id,\r\n\t\t\t\tsuccess(model, response, options) {\r\n\t\t\t\t\tme.trigger(\"retrieve\", model);\r\n\t\t\t\t},\r\n\t\t\t\terror(model, response, options) {\r\n\t\t\t\t\tme.handleRequestErrors([], options.xhr);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t},\r\n\tupdate(model) {\r\n\t\tif (!model) {\r\n\t\t\tconsole.error(\"Store: You must pass a model on the payload to request an update.\");\r\n\t\t} else {\r\n\t\t\tif (!this.get(model.get(\"id\"))) {\r\n\t\t\t\tthis.add(model);\r\n\t\t\t}\r\n\t\t\tmodel.save();\r\n\t\t}\r\n\t},\r\n\tdestroy(model) {\r\n\t\tif (!model) {\r\n\t\t\tconsole.error(\"Store: You must pass a model on the payload to request a destroy.\");\r\n\t\t} else {\r\n\t\t\tmodel.destroy({\r\n\t\t\t\turl: this.url + \"/\" + model.get(\"id\")\r\n\t\t\t});\r\n\t\t}\r\n\t},\r\n\tfind(data) {\r\n\t\tvar me = this;\r\n\t\tme.fetch({\r\n\t\t\tdata: data\r\n\t\t});\r\n\t},\r\n\r\n\tupdateField(params) {\r\n\t\tif (!params) {\r\n\t\t\tconsole.error(\"Store: You must pass data on the payload to request a field update.\");\r\n\t\t} else {\r\n\t\t\tvar me = this;\r\n\t\t\t$.ajax({\r\n\t\t\t\tmethod: \"POST\",\r\n\t\t\t\turl: me.url+\"/update/field\",\r\n\t\t\t\tdataType: 'json',\r\n\t\t\t\tdata: params,\r\n\t\t\t\tsuccess(data, status, opts) {\r\n\t\t\t\t\tme.trigger(\"fieldupdated\", data);\r\n\t\t\t\t},\r\n\t\t\t\terror(opts, status, errorMsg) {\r\n\t\t\t\t\tme.handleRequestErrors([], opts);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t},\r\n});\r\n\r\nmodule.exports = {\r\n\tBACKEND_URL: BACKEND_URL,\r\n\tModel: Model,\r\n\tStore: Store\r\n};\r\n"]}